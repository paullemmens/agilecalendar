---
title: Agile Cadence Calendar
output:
  flexdashboard::flex_dashboard:
    vertical_scroll: fill
    dev: svg
runtime: shiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(fig.asp = 0.618)
require(tidyverse)
require(flexdashboard)
require(ggrepel)
devtools::load_all()
```

Sidebar {.sidebar data-width=300}
=====================================

### Plot setup

```{r marker check boxes}
checkboxInput('cadence_markers', 'Plot cadence markers', value = TRUE)
checkboxInput('personal_markers', 'Plot personal markers', value = TRUE)
checkboxInput('today', 'Plot today marker', value = TRUE)
```


Viewer
========

```{r load configuration}
cfg_file <- pkgload::package_file('inst', 'default_config.yml')
cfg <- reactive({
  req(cfg_file)
  read_config(cfg_file)
})
acc <- reactive({
  generate_calendar(cfg = cfg())
})
```

Viewer {.tabset}
----------------

### Visual

```{r visual-calendar}
renderPlot({
  p <- plot_calendar(cal = acc())
  if (input$cadence_markers) p <- p + plot_markers(cal = acc(), markers = 'agile_events')
  if (input$personal_markers) p <- p + plot_markers(cal = acc(), markers = 'markers')
  if (input$today) p <- p + today_marker()
  return(p)
})
```

### Calendar


Configuration
=============

Configuration {data-height=900}
--------------------------------

```{r show configuration}
cfg_txt <- reactive({
  req(cfg_file)
  d <- readLines(con = cfg_file, collapse = '\n')
  return(d)
})
cfg <- reactive({
  req(cfg_file)
  read_config(cfg_file)
})
textAreaInput('config', label = NULL, width = '100%', rows = 15,
              placeholder = 'Enter or load configuration YAML')
```

Row {data-height=100}
----------------------

Buttons: upload / load package default, save

```{r upload file}
fileInput('cfg_upload', label = NULL, accept = c('yml', 'yaml'))
```

```{r load default file}
cfg_file <- pkgload::package_file('inst/default_config.yml')
```
