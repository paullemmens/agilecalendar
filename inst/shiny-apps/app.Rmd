---
title: Agile Cadence Calendar
output:
  flexdashboard::flex_dashboard:
    vertical_scroll: fill
    dev: svg
runtime: shiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(fig.asp = 0.618)
require(tidyverse)
require(flexdashboard)
require(ggrepel)
devtools::load_all()
```

Sidebar {.sidebar data-width=300}
=====================================

### Plot setup

```{r marker check boxes}
checkboxInput('cadence_markers', 'Plot cadence markers', value = TRUE)
checkboxInput('personal_markers', 'Plot personal markers', value = TRUE)
checkboxInput('today', 'Plot today marker', value = TRUE)
```


Viewer
========

```{r load configuration}
cfg_file <- pkgload::package_file('inst', 'default_config.yml')
cfg <- reactive({
  req(cfg_file)
  read_config(cfg_file)
})
acc <- reactive({
  generate_calendar(cfg = cfg())
})
```

Viewer {.tabset}
----------------

### Visual

```{r visual-calendar}

renderPlot({
  p <- plot_calendar(cal = acc())
  if (input$cadence_markers) p <- p + cadence_markers(cal = acc())
  if (input$today) p <- p + today_marker()
  return(p)
})

```

### Calendar

Configuration
=============

Configuration
-----------------

```{r show configuration}
cfg_txt <- reactive({
  req(cfg_file)
  d <- readLines(con = cfg_file)
  splitted <- stringi::stri_split(str = d, regex = '\\n')
  newtxt <- lapply(splitted, p)
  return(newtxt)
})
cfg <- reactive({
  req(cfg_file)
  read_config(cfg_file)
})
## renderPrint({
##   cfg_txt()
## })
renderTable(acc())
renderTable(cfg()$markers)
renderTable(cfg()$agile_events)
```
